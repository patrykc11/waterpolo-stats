generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Settings {
  id          Int    @id @default(1)
  activeMatch String @default("")
  quarter     Int    @default(1)
  editorPIN   String @default("")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("settings")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  role      String   @default("viewer") // viewer | editor
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Player {
  id        String   @id @default(cuid())
  playerId  String   @unique @map("player_id")
  number    Int      @default(0)
  name      String
  team      String   @default("my")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  events      Event[]
  matchRoster MatchRoster[]

  @@map("players")
}

model Match {
  id          String   @id @default(cuid())
  matchId     String   @unique @map("match_id")
  date        String   @default("")
  opponent    String   @default("")
  place       String   @default("")
  ageCategory String   @default("Seniorzy") @map("age_category") // U17, U19, Seniorzy
  status      String   @default("active") // active | ended
  archived    Boolean  @default(false) // soft delete flag
  
  // Scores
  q1My      Int      @default(0) @map("q1_my")
  q1Opp     Int      @default(0) @map("q1_opp")
  q2My      Int      @default(0) @map("q2_my")
  q2Opp     Int      @default(0) @map("q2_opp")
  q3My      Int      @default(0) @map("q3_my")
  q3Opp     Int      @default(0) @map("q3_opp")
  q4My      Int      @default(0) @map("q4_my")
  q4Opp     Int      @default(0) @map("q4_opp")
  finalMy   Int      @default(0) @map("final_my")
  finalOpp  Int      @default(0) @map("final_opp")
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  events      Event[]
  matchRoster MatchRoster[]

  @@map("matches")
}

model MatchRoster {
  id        String   @id @default(cuid())
  matchId   String   @map("match_id")
  playerId  String   @map("player_id")
  number    Int
  name      String
  team      String   @default("my")
  createdAt DateTime @default(now())

  match  Match  @relation(fields: [matchId], references: [matchId], onDelete: Cascade)
  player Player @relation(fields: [playerId], references: [playerId], onDelete: Cascade)

  @@unique([matchId, playerId])
  @@map("match_roster")
}

model Event {
  id         String   @id @default(cuid())
  timestamp  DateTime @default(now())
  matchId    String   @map("match_id")
  quarter    Int      @default(1)
  team       String   @default("my")
  playerId   String   @map("player_id")
  playerName String   @map("player_name")
  eventType  String   @default("") @map("event_type")
  subtype    String   @default("")
  value      String   @default("")
  note       String   @default("")
  
  // ATAK POZYCYJNY (15 p贸l)
  isGoalFromPlayPositional         Int @default(0) @map("is_goal_from_play_positional")
  isGoalFromPlayCounter            Int @default(0) @map("is_goal_from_play_counter")
  isGoalFromCenterPositional       Int @default(0) @map("is_goal_from_center_positional")
  isAssistPositional               Int @default(0) @map("is_assist_positional")
  isShotSavedGkPositional          Int @default(0) @map("is_shot_saved_gk_positional")
  isShotMissTurnoverPositional     Int @default(0) @map("is_shot_miss_turnover_positional")
  isShotMissReset30Positional      Int @default(0) @map("is_shot_miss_reset30_positional")
  isBadPassTurnoverPositional      Int @default(0) @map("is_bad_pass_turnover_positional")
  isBadPassNoTurnoverPositional    Int @default(0) @map("is_bad_pass_no_turnover_positional")
  isTurnover1v1Positional          Int @default(0) @map("is_turnover_1v1_positional")
  isShotClockViolationPositional   Int @default(0) @map("is_shot_clock_violation_positional")
  isExclDrawnFieldPositional       Int @default(0) @map("is_excl_drawn_field_positional")
  isExclDrawnCenterPositional      Int @default(0) @map("is_excl_drawn_center_positional")
  isPenaltyDrawnFieldPositional    Int @default(0) @map("is_penalty_drawn_field_positional")
  isPenaltyDrawnCenterPositional   Int @default(0) @map("is_penalty_drawn_center_positional")
  
  // ATAK PRZEWAGA (10 p贸l)
  isGoalFromCenterManUp            Int @default(0) @map("is_goal_from_center_man_up")
  isGoal5mManUp                    Int @default(0) @map("is_goal_5m_man_up")
  isAssistManUp                    Int @default(0) @map("is_assist_man_up")
  isShotSavedGkManUp               Int @default(0) @map("is_shot_saved_gk_man_up")
  isShotMissTurnoverManUp          Int @default(0) @map("is_shot_miss_turnover_man_up")
  isShotMissReset30ManUp           Int @default(0) @map("is_shot_miss_reset30_man_up")
  isBadPassTurnoverManUp           Int @default(0) @map("is_bad_pass_turnover_man_up")
  isBadPassNoTurnoverManUp         Int @default(0) @map("is_bad_pass_no_turnover_man_up")
  isTurnover1v1ManUp               Int @default(0) @map("is_turnover_1v1_man_up")
  isShotClockViolationManUp        Int @default(0) @map("is_shot_clock_violation_man_up")
  
  // RZUTY KARNE (1 pole)
  isGoal5mPenalty                  Int @default(0) @map("is_goal_5m_penalty")
  
  // OBRONA POZYCYJNA (9 p贸l)
  isNoReturnPositional             Int @default(0) @map("is_no_return_positional")
  isExclCommittedFieldPositional   Int @default(0) @map("is_excl_committed_field_positional")
  isExclCommittedCenterPositional  Int @default(0) @map("is_excl_committed_center_positional")
  isPenaltyCommittedFieldPositional Int @default(0) @map("is_penalty_committed_field_positional")
  isPenaltyCommittedCenterPositional Int @default(0) @map("is_penalty_committed_center_positional")
  isShotSavedGkDefPositional       Int @default(0) @map("is_shot_saved_gk_def_positional")
  isStealPositional                Int @default(0) @map("is_steal_positional")
  isBlockHandPositional            Int @default(0) @map("is_block_hand_positional")
  isNoBlockPositional              Int @default(0) @map("is_no_block_positional")
  
  // OBRONA PRZEWAGA (9 p贸l)
  isNoReturnManUp                  Int @default(0) @map("is_no_return_man_up")
  isExclCommittedFieldManUp        Int @default(0) @map("is_excl_committed_field_man_up")
  isExclCommittedCenterManUp       Int @default(0) @map("is_excl_committed_center_man_up")
  isPenaltyCommittedFieldManUp     Int @default(0) @map("is_penalty_committed_field_man_up")
  isPenaltyCommittedCenterManUp    Int @default(0) @map("is_penalty_committed_center_man_up")
  isShotSavedGkDefManUp            Int @default(0) @map("is_shot_saved_gk_def_man_up")
  isStealManUp                     Int @default(0) @map("is_steal_man_up")
  isBlockHandManUp                 Int @default(0) @map("is_block_hand_man_up")
  isNoBlockManUp                   Int @default(0) @map("is_no_block_man_up")
  
  createdAt DateTime @default(now())

  match  Match  @relation(fields: [matchId], references: [matchId], onDelete: Cascade)
  player Player @relation(fields: [playerId], references: [playerId], onDelete: Cascade)

  @@index([matchId, quarter])
  @@map("events")
}

